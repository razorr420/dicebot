<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Dice Sender</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Session Expired Overlay -->
    <div class="session-expired-overlay" id="sessionExpiredOverlay">
        <div class="session-expired-box">
            <div class="icon">‚è∞</div>
            <h2>Tracker Auto-Stopped</h2>
            <p id="expiredOverlayText">Your tracker session has ended after 5 minutes.</p>
            <button class="btn" onclick="closeExpiredOverlay()">OK, Got it</button>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üé≤ Telegram Dice</h1>
            <p>Send dice & auto tracker</p>
        </div>

        <!-- Global Timer -->
        <div class="global-timer" id="globalTimer">
            <div class="timer-left">
                <span class="timer-icon" id="timerIcon">‚è±Ô∏è</span>
                <div>
                    <div class="timer-label" id="timerLabel">Tracker Auto-Stop In</div>
                    <div class="timer-display" id="timerDisplay">05:00</div>
                </div>
            </div>
            <div class="timer-status">
                <span class="timer-status-badge active" id="timerStatusBadge">‚óè Tracker Active</span>
            </div>
        </div>
        <div class="timer-progress" id="timerProgressContainer">
            <div class="timer-progress-bar" id="timerProgressBar" style="width: 100%;"></div>
        </div>

        <div class="content">
            <!-- Login Page -->
            <div id="loginPage" class="page active">
                <div class="error-msg" id="loginError"></div>
                <div class="input-group">
                    <label for="apiKey">API Key</label>
                    <div class="input-with-icon">
                        <input type="password" id="apiKey" placeholder="Enter your API key" />
                        <span class="key-icon">üîë</span>
                    </div>
                    <small>Enter the API key provided by the administrator</small>
                </div>
                <div class="input-group">
                    <label for="phoneNumber">Phone Number</label>
                    <input type="tel" id="phoneNumber" placeholder="+911234567890" />
                    <small>Include country code (e.g., +911234567890 for India)</small>
                </div>
                <button class="btn" id="loginBtn" onclick="sendOTP()">
                    <span id="loginBtnText">Login with Telegram</span>
                </button>
                <p class="info-text">Enter your API key and phone number to receive OTP via Telegram</p>
            </div>

            <!-- OTP Page -->
            <div id="otpPage" class="page">
                <div class="success-msg show">OTP sent to your Telegram!</div>
                <div class="error-msg" id="otpError"></div>
                <div class="input-group">
                    <label for="otpCode">Enter OTP Code</label>
                    <input type="text" id="otpCode" placeholder="12345" maxlength="6" />
                    <small>Check your Telegram messages</small>
                </div>
                <button class="btn" id="verifyBtn" onclick="verifyOTP()">
                    <span id="verifyBtnText">Verify OTP</span>
                </button>
                <button class="btn logout-btn" onclick="backToLogin()">Back</button>
            </div>

            <!-- Password Page (for 2FA) -->
            <div id="passwordPage" class="page">
                <div class="info-msg show">Your account has 2FA enabled</div>
                <div class="error-msg" id="passwordError"></div>
                <div class="input-group">
                    <label for="password2FA">Two-Factor Password</label>
                    <input type="password" id="password2FA" placeholder="Enter your 2FA password" />
                </div>
                <button class="btn" id="passwordBtn" onclick="verify2FA()">
                    <span id="passwordBtnText">Verify Password</span>
                </button>
                <button class="btn logout-btn" onclick="backToLogin()">Back</button>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page">
                <div class="dashboard-header">
                    <h2>Dashboard</h2>
                    <span class="status-badge" id="dashboardStatusBadge">‚óè Active</span>
                </div>

                <!-- Tabs -->
                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('manualTab')">Group Send</button>
                    <button class="tab" onclick="switchTab('dmTab')">DM Send</button>
                    <button class="tab" onclick="switchTab('trackerTab')">Group Track</button>
                    <button class="tab" onclick="switchTab('dmTrackerTab')">DM Track</button>
                </div>

                <div class="success-msg" id="successMsg"></div>
                <div class="error-msg" id="errorMsg"></div>

                <!-- Manual Send Tab (Group) -->
                <div id="manualTab" class="tab-content active">
                    <div class="section-header">
                        <span class="icon">üë•</span>
                        <h3>Send to Group/Channel</h3>
                    </div>
                    <div class="input-group">
                        <label for="chatId">Chat ID</label>
                        <input type="text" id="chatId" placeholder="Enter chat ID or username" />
                        <small>Can be username (@username) or numeric ID</small>
                    </div>
                    <div class="input-group">
                        <label for="maxDeletions">Deletion Limit (Optional)</label>
                        <input type="number" id="maxDeletions" placeholder="Leave empty for default" min="0" max="10" />
                        <small>Empty = keep first, delete rest | 0 = never delete | 1+ = delete that many times</small>
                    </div>
                    <div class="input-group">
                        <label>Select Bad Dice Numbers</label>
                        <div class="dice-grid" id="manualDiceGrid">
                            <div class="dice-box" data-value="1" onclick="toggleDice(1, 'manual')">1</div>
                            <div class="dice-box" data-value="2" onclick="toggleDice(2, 'manual')">2</div>
                            <div class="dice-box" data-value="3" onclick="toggleDice(3, 'manual')">3</div>
                            <div class="dice-box" data-value="4" onclick="toggleDice(4, 'manual')">4</div>
                            <div class="dice-box" data-value="5" onclick="toggleDice(5, 'manual')">5</div>
                            <div class="dice-box" data-value="6" onclick="toggleDice(6, 'manual')">6</div>
                        </div>
                        <small>First occurrence kept, repeats deleted (up to limit)</small>
                    </div>
                    <button class="btn" id="sendDiceBtn" onclick="sendDice()">
                        <span id="sendDiceBtnText">üé≤ Send Dice</span>
                    </button>
                </div>

                <!-- Personal DM Send Tab (Using same /send-dice API as Group) -->
                <div id="dmTab" class="tab-content">
                    <div class="section-header">
                        <span class="icon">üí¨</span>
                        <h3>Send to Personal DM</h3>
                        <span class="dm-badge">Direct Message</span>
                    </div>
                    
                    <div class="input-group">
                        <label for="dmUserId">User ID / Username</label>
                        <input type="text" id="dmUserId" placeholder="@username or numeric user ID" />
                        <small>Enter the user's @username or their numeric Telegram ID</small>
                    </div>
                    <div class="input-group">
                        <label for="dmMaxDeletions">Deletion Limit (Optional)</label>
                        <input type="number" id="dmMaxDeletions" placeholder="Leave empty for default" min="0" max="10" />
                        <small>Empty = keep first, delete rest | 0 = never delete | 1+ = delete that many times</small>
                    </div>
                    <div class="input-group">
                        <label for="dmTotalDice">Total Dice to Send</label>
                        <input type="number" id="dmTotalDice" placeholder="6" min="1" max="20" value="6" />
                        <small>Number of dice to send (default: 6)</small>
                    </div>
                    <div class="input-group">
                        <label>Select Bad Dice Numbers</label>
                        <div class="dice-grid" id="dmDiceGrid">
                            <div class="dice-box" data-value="1" onclick="toggleDice(1, 'dm')">1</div>
                            <div class="dice-box" data-value="2" onclick="toggleDice(2, 'dm')">2</div>
                            <div class="dice-box" data-value="3" onclick="toggleDice(3, 'dm')">3</div>
                            <div class="dice-box" data-value="4" onclick="toggleDice(4, 'dm')">4</div>
                            <div class="dice-box" data-value="5" onclick="toggleDice(5, 'dm')">5</div>
                            <div class="dice-box" data-value="6" onclick="toggleDice(6, 'dm')">6</div>
                        </div>
                        <small>First occurrence kept, repeats deleted (up to limit)</small>
                    </div>
                    
                    <button class="btn btn-purple" id="sendDmDiceBtn" onclick="sendDmDice()">
                        <span id="sendDmDiceBtnText">üí¨ Send Dice to DM</span>
                    </button>
                </div>

                <!-- Group Auto Tracker Tab -->
                <div id="trackerTab" class="tab-content">
                    <div class="timer-info-box" id="trackerTimerInfo">
                        <div class="timer-row">
                            <span class="timer-label">‚è±Ô∏è Auto-Stop In</span>
                            <span class="timer-value" id="trackerTimerDisplay">05:00</span>
                        </div>
                        <div class="timer-note">Tracker will automatically stop after 5 minutes</div>
                    </div>
                    <div class="switch-container">
                        <span class="switch-label">Group Auto Tracker</span>
                        <label class="switch">
                            <input type="checkbox" id="trackerSwitch" onchange="toggleTracker('group')">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="tracker-status" id="trackerStatusBox" style="display: none;">
                        <div class="row"><span class="label">Status</span><span class="value" id="trackerStatusText">Inactive</span></div>
                        <div class="row"><span class="label">Chat ID</span><span class="value" id="trackerChatId">-</span></div>
                        <div class="row"><span class="label">Bad Values</span><span class="value" id="trackerBadValues">-</span></div>
                        <div class="row"><span class="label">Deletion Limit</span><span class="value" id="trackerDeletionLimit">-</span></div>
                        <div class="row"><span class="label">Replace Until Good</span><span class="value" id="trackerReplaceUntilGood">-</span></div>
                    </div>
                    <div class="stats-grid" id="trackerStats" style="display: none;">
                        <div class="stat-box"><div class="label">Total Dice</div><div class="value" id="statTotalDice">0</div></div>
                        <div class="stat-box"><div class="label">Deleted</div><div class="value" id="statDeleted">0</div></div>
                        <div class="stat-box"><div class="label">Kept</div><div class="value" id="statKept">0</div></div>
                        <div class="stat-box"><div class="label">Duration</div><div class="value" id="statDuration">0s</div></div>
                    </div>
                    <div id="activityLogContainer" style="display: none;">
                        <div class="input-group">
                            <label>Activity Log</label>
                            <div id="activityLog" class="activity-log"></div>
                        </div>
                    </div>
                    <div id="trackerConfig">
                        <div class="input-group">
                            <label for="trackerChatIdInput">Chat ID</label>
                            <input type="text" id="trackerChatIdInput" placeholder="Enter chat ID or username" />
                        </div>
                        <div class="input-group">
                            <label for="trackerDeletionLimitInput">Deletion Limit</label>
                            <input type="number" id="trackerDeletionLimitInput" placeholder="Leave empty for default" min="0" max="10" />
                            <small>Empty = keep first, delete rest | 0 = never delete</small>
                        </div>
                        <div class="switch-container">
                            <div>
                                <span class="switch-label">Replace Until Good Value</span>
                                <small style="display: block; color: #666; font-weight: normal; margin-top: 4px;">Keep replacing deleted dice until a non-bad value appears</small>
                            </div>
                            <label class="switch"><input type="checkbox" id="replaceUntilGoodSwitch"><span class="slider"></span></label>
                        </div>
                        <div class="input-group">
                            <label>Select Bad Dice Numbers</label>
                            <div class="dice-grid" id="trackerDiceGrid">
                                <div class="dice-box" data-value="1" onclick="toggleDice(1, 'tracker')">1</div>
                                <div class="dice-box" data-value="2" onclick="toggleDice(2, 'tracker')">2</div>
                                <div class="dice-box" data-value="3" onclick="toggleDice(3, 'tracker')">3</div>
                                <div class="dice-box" data-value="4" onclick="toggleDice(4, 'tracker')">4</div>
                                <div class="dice-box" data-value="5" onclick="toggleDice(5, 'tracker')">5</div>
                                <div class="dice-box" data-value="6" onclick="toggleDice(6, 'tracker')">6</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DM Auto Tracker Tab -->
                <div id="dmTrackerTab" class="tab-content">
                    <div class="timer-info-box purple" id="dmTrackerTimerInfo">
                        <div class="timer-row">
                            <span class="timer-label">‚è±Ô∏è Auto-Stop In</span>
                            <span class="timer-value" id="dmTrackerTimerDisplay">05:00</span>
                        </div>
                        <div class="timer-note">DM Tracker will automatically stop after 5 minutes</div>
                    </div>
                    <div class="switch-container purple">
                        <span class="switch-label">üí¨ DM Auto Tracker</span>
                        <label class="switch">
                            <input type="checkbox" id="dmTrackerSwitch" onchange="toggleTracker('dm')">
                            <span class="slider purple"></span>
                        </label>
                    </div>
                    <div class="tracker-status purple" id="dmTrackerStatusBox" style="display: none;">
                        <div class="row"><span class="label">Status</span><span class="value" id="dmTrackerStatusText">Inactive</span></div>
                        <div class="row"><span class="label">User ID</span><span class="value" id="dmTrackerUserId">-</span></div>
                        <div class="row"><span class="label">Bad Values</span><span class="value" id="dmTrackerBadValues">-</span></div>
                        <div class="row"><span class="label">Deletion Limit</span><span class="value" id="dmTrackerDeletionLimit">-</span></div>
                        <div class="row"><span class="label">Replace Until Good</span><span class="value" id="dmTrackerReplaceUntilGood">-</span></div>
                    </div>
                    <div class="stats-grid" id="dmTrackerStats" style="display: none;">
                        <div class="stat-box purple"><div class="label">Total Dice</div><div class="value" id="dmStatTotalDice">0</div></div>
                        <div class="stat-box purple"><div class="label">Deleted</div><div class="value" id="dmStatDeleted">0</div></div>
                        <div class="stat-box purple"><div class="label">Kept</div><div class="value" id="dmStatKept">0</div></div>
                        <div class="stat-box purple"><div class="label">Duration</div><div class="value" id="dmStatDuration">0s</div></div>
                    </div>
                    <div id="dmActivityLogContainer" style="display: none;">
                        <div class="input-group">
                            <label>Activity Log</label>
                            <div id="dmActivityLog" class="activity-log"></div>
                        </div>
                    </div>
                    <div id="dmTrackerConfig">
                        <div class="section-header">
                            <span class="icon">üí¨</span>
                            <h3>DM Tracker Settings</h3>
                            <span class="dm-badge">Personal</span>
                        </div>
                        <div class="input-group">
                            <label for="dmTrackerUserIdInput">User ID / Username</label>
                            <input type="text" id="dmTrackerUserIdInput" placeholder="@username or numeric user ID" />
                            <small>Enter the user's @username or their numeric Telegram ID</small>
                        </div>
                        <div class="input-group">
                            <label for="dmTrackerDeletionLimitInput">Deletion Limit</label>
                            <input type="number" id="dmTrackerDeletionLimitInput" placeholder="Leave empty for default" min="0" max="10" />
                            <small>Empty = keep first, delete rest | 0 = never delete</small>
                        </div>
                        <div class="switch-container purple">
                            <div>
                                <span class="switch-label">Replace Until Good Value</span>
                                <small style="display: block; color: #666; font-weight: normal; margin-top: 4px;">Keep replacing deleted dice until a non-bad value appears</small>
                            </div>
                            <label class="switch"><input type="checkbox" id="dmReplaceUntilGoodSwitch"><span class="slider purple"></span></label>
                        </div>
                        <div class="input-group">
                            <label>Select Bad Dice Numbers</label>
                            <div class="dice-grid" id="dmTrackerDiceGrid">
                                <div class="dice-box" data-value="1" onclick="toggleDice(1, 'dmTracker')">1</div>
                                <div class="dice-box" data-value="2" onclick="toggleDice(2, 'dmTracker')">2</div>
                                <div class="dice-box" data-value="3" onclick="toggleDice(3, 'dmTracker')">3</div>
                                <div class="dice-box" data-value="4" onclick="toggleDice(4, 'dmTracker')">4</div>
                                <div class="dice-box" data-value="5" onclick="toggleDice(5, 'dmTracker')">5</div>
                                <div class="dice-box" data-value="6" onclick="toggleDice(6, 'dmTracker')">6</div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
